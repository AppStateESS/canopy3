#!/usr/bin/env php


<?php
/**
 * MIT License
 * Copyright (c) 2021 Electronic Student Services @ Appalachian State University
 *
 * See LICENSE file in root directory for copyright and distribution permissions.
 *
 * @author Matthew McNaney <mcnaneym@appstate.edu>
 * @license https://opensource.org/licenses/MIT
 */
//require_once '../DirectoryDefines.php';
require_once 'src/DashboardFunctions.php';

function message($message)
{
    echo $message;
    echo "\n";
    exit();
}

function run(array $argv)
{
    if (empty($argv[1])) {
        message('Usage: "addDashboard name-of-dashboard"');
    }
    $forceUpdate = false;
    array_shift($argv);
    foreach ($argv as $argument) {
        switch ($argument) {
            case '-f':
                $forceUpdate = true;

            default:
                $dashboard = $argument;
        }
    }

    try {
        $dashboard = getDashboardJSON($dashboard);
        $dashboardData = getDashboardData();
        // if false, we start with an empty array and write to it
        if ($dashboardData == false) {
            $dashboardData = new stdClass();
        }

        if (!addDashboardData($dashboardData, $dashboard, $forceUpdate)) {
            message($dashboard->name . ' is already in dashboard file.');
        }
        if (saveDashboardData($dashboardData)) {
            message($dashboard->name . ' added to dashboard file.');
        } else {
            message('Failed to save ' . $dashboard->name . ' to dashboard file.');
        }
    } catch (Exception $ex) {
        message($ex->getMessage());
    }
}

run($argv);
